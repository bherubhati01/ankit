{% extends 'base.html' %}

{% block body %}
    
{% load static %}

<div class="container bg-slate-50 max-w-[393px] w-full min-h-[100vh] h-full mx-auto shadow-transparent rounded-sm">

     
    <form class="max-w-md mx-auto p-6">   
        <label for="default-search" class="mb-2 text-sm font-medium text-gray-900 sr-only dark:text-white">Search</label>
        <div class="relative">
            <div class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none">
                <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"/>
                </svg>
            </div>
            <input type="search" id="default-search" class="block w-full p-4 ps-10 text-sm text-gray-900 border border-gray-300 rounded-lg bg-gray-50 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="Search Users..." required />
            <button type="submit" class="text-white absolute end-2.5 bottom-2.5 bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-4 py-2 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">Search</button>
        </div>
    </form>


    <!-- Add this part to display search results for users -->
    <div id="users-results">
        <ul class="max-w-md divide-y divide-gray-200 dark:divide-gray-700 px-7 usersresults">
            {% for user in users %}
            <li class="pb-3 sm:pb-4 pt-3 sm:pt-4">
                <div class="flex items-center space-x-4 rtl:space-x-reverse">
                    <div class="flex justify-center items-center bg-indigo-200 rounded-full">
                        <img class="w-10 h-10 rounded-full" src="{{ user.profile_image.url }}" alt="{{ user.username }}">
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="text-sm font-medium text-gray-900 truncate dark:text-white">
                            {{ user.first_name }} {{ user.last_name }}
                        </p>
                        <p class="text-sm text-gray-500 truncate dark:text-gray-400">
                            @{{ user.username }}
                        </p>
                    </div>
                </div>
            </li>
            {% endfor %}
        </ul>

        <ul class="max-w-md divide-y divide-gray-200 dark:divide-gray-700 px-7">
            {% for post in posts %}
            <li class="pb-3 sm:pb-4 pt-3 sm:pt-4">
                <!-- Display post details as needed -->
                <p class="text-sm font-medium text-gray-900 truncate dark:text-white">
                    {{ post.user.username }} - {{ post.caption }}
                </p>
            </li>
            {% endfor %}
        </ul>
    </div>




    <div class="border-t bg-slate-50 h-10 fixed bottom-0 max-w-[393px] w-full flex justify-around items-center">
        <a href="/home">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" />
            </svg>              
        </a>
        <a href="/search">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
            </svg>              
        </a>
        <a href="/upload">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 10.5v6m3-3H9m4.06-7.19-2.12-2.12a1.5 1.5 0 0 0-1.061-.44H4.5A2.25 2.25 0 0 0 2.25 6v12a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9a2.25 2.25 0 0 0-2.25-2.25h-5.379a1.5 1.5 0 0 1-1.06-.44Z" />
            </svg>              
        </a>
        <a href="/notification">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z" />
            </svg>                  
        </a> 
        <a href="/profile">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
            </svg>              
        </a>
    </div>


</div>


<script>
    $(document).ready(function () {
        $('form').submit(function (event) {
            event.preventDefault();
            var query = $('#default-search').val();

            $.ajax({
                type: 'GET',
                url: '{% url "search" %}',
                data: {
                    'q': query
                },
                success: function (data) {
                    if (data.success) {
                        // Clear previous results
                        $('.usersresults').empty();

                        // Update user results
                        var users = data.context.users;
                        // console.log(users)
                        users.map((user)=>{

                            // console.log($('.usersresults'))
                            $('.usersresults').append(`
                            <li class="pb-3 sm:pb-4 pt-3 sm:pt-4">
                                <div class="flex items-center space-x-4 rtl:space-x-reverse">
                                    <div class="flex justify-center items-center bg-indigo-200 rounded-full">
                                        <img class="w-10 h-10 rounded-full" src="/media/${user.profile_image}" alt="">
                                    </div>
                                    <div class="flex flex-col justify-center items-start min-w-0">
                                        <a href='/profile/${user.username}' class="text-sm font-semibold text-gray-900 truncate dark:text-white">
                                            ${ user.first_name } ${ user.last_name }
                                        </a>
                                        <a href='/profile/${user.username}' class="text-sm text-gray-500 truncate dark:text-gray-400">
                                            @${ user.username }
                                        </a>
                                    </div>
                                </div>
                            </li>
                            `)
                        });

                    } else {
                        // console.log('Search unsuccessful');
                    }
                }
            });
        });
    });
</script>



{% endblock body %}